---
layout: post
title: How to increase semaphore value in linux
date: 2012-11-08 08:03:00.000000000 +05:30
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Linux
tags: []
meta:
  blogger_blog: ijuned.blogspot.com
  blogger_7553295648c4d8ebded8b8484926da00_permalink: '404270302202957037'
---
<div dir="ltr" style="text-align:left;"><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;"><strong>How to increase semaphore value in linux?</strong></span><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;">Semaphore can be described as counters used to control access to shared resources by multiple processes, They are most often used as a locking mechanism to prevent processes from accessing a particular resource while another process is performing operations on it.</span><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;">Semaphore can be used when number of processes try to access the shared resource or same file,Semaphore stored in kernel, so that it can be accessed by all the processes,</span><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;"># Semaphore can be identified unique id in linux kernel and it can be deleted using semdelete function,</span><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;"># semaphore values can be incremented or decremented by using functions wait and signal,   </span><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;">If we are using ONFS (Oracle over network file system) in linux, we need to increase the kernel.sem value to improve system performance</span><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;"><strong>Increasing semaphore value in linux</strong></span><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;">[root@server ~]# sysctl -A | grep kernel.sem<br />kernel.sem = 250        32000   32      128</span><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;">[root@server ~]# <strong>ipcs -ls</strong></span><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;">------ Semaphore Limits --------<br />max number of arrays = 128<br />max semaphores per array = 250<br />max semaphores system wide = 32000<br /><strong>max ops per semop call = 32</strong>semaphore max value = 32767</span></p>
<p><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;">Increase semop value from 32 to 100, it can be increased upto 250 which is equal to semaphores per array,</span><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;"><strong>Add the following line into /etc/sysctl.conf file,</strong></span><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;">vi /etc/sysctl.conf<br />kernel.sem = 250 32000 100 128</span><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;">or<br /><strong>sysctl -w "kernel.sem = 250 32000 100 128"</strong></span><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;">or </span><br /><strong><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;">sysctl -w "kernel.sem=4096 512000 1600 2048"    [ Value reducing your CPU usage from avg 50% to 20%]</span></strong><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;"><strong>kernel.sem: max_sem_per_id max_sem_total max_ops_sem_call max_sem_ids</strong></span><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;">Now we have modified the kernel.sem value,</span><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;"><strong>Please run the following command to update the changes,</strong>[root@server ~]# sysctl -p<br />net.ipv4.ip_forward = 1<br />net.ipv4.conf.default.rp_filter = 1<br />net.ipv4.conf.default.accept_source_route = 0<br />kernel.sysrq = 1<br />kernel.core_uses_pid = 1<br />net.ipv4.tcp_syncookies = 1<br />kernel.msgmnb = 65536<br />kernel.msgmax = 65536<br />kernel.shmmax = 4294967295<br />kernel.shmall = 268435456<br /><strong>kernel.sem = 250 32000 100 128</strong>net.ipv6.conf.default.forwarding = 1<br />net.ipv6.conf.all.forwarding = 1<br />net.ipv4.conf.default.proxy_arp = 0<br />net.ipv4.conf.all.rp_filter = 1<br />net.ipv4.conf.default.send_redirects = 1<br />net.ipv4.conf.all.send_redirects = 0</span><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;">Run ipcs command to ensure the kernel.sem value</span></p>
<p><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;">[root@server ~]# ipcs -ls</span><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;">------ Semaphore Limits --------<br />max number of arrays = 128<br />max semaphores per array = 250<br />max semaphores system wide = 32000<br />max ops per semop call =<strong> 100</strong>semaphore max value = 32767</span><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;">Now system will be supported to handle numerous system call at the same time.</span><br /><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;"><br /></span><span style="font-family:tahoma, arial, helvetica, sans-serif;font-size:x-small;"><a href="http://kernelmount.com/content/view/81/9/">Reference</a></span></p>
<p><a href="http://www.embeddedheaven.com/linux-semaphore-tutorial.htm">http://www.embeddedheaven.com/linux-semaphore-tutorial.htm</a></div>
